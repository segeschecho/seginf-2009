\chapter{Instalación y uso}
A continuación daremos una guía para realizar la instalación del sniffer y de reporTool. En ambos casos, presentaremos los pasos para un sistema operativo similar a Ubuntu, con python 2.6 ya instalado (por defecto en ubuntu).

\section{Instalación del sniffer}
\begin{enumerate}
\item Instalar easy\_install para python:

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}\\
\hlstd{}\hlsym{$>$\ }\hlstd{sudo\ apt}\hlsym{{-}}\hlstd{get\ }\hlkwc{install\ }\hlstd{python}\hlsym{{-}}\hlstd{setuptools\ python}\hlsym{{-}}\hlstd{dev\ build}\hlsym{{-}}\hlstd{essential}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}

\item Instalar scapy:
 
\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}\\
\hlstd{}\hlsym{$>$\ }\hlstd{sudo\ easy\textunderscore install\ scapy}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}


Si esto falla, instala scapy con apt-get (minimo la versión 2):

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}\\
\hlstd{}\hlsym{$>$\ }\hlstd{sudo\ apt}\hlsym{{-}}\hlstd{get\ }\hlkwc{install\ }\hlstd{scapy}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}


\item Instalar sqlAlchemy (ORM para la base de datos):

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}
\hlstd{}\hlsym{$>$\ }\hlstd{sudo\ easy\textunderscore install\ sqlalchemy}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}

\item Instalar dpkt (Armado y manipulación de paquetes para varios protocolos), para ello, extraerlo, pararse en el directorio y ejecutar:

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}
\hlstd{}\hlsym{$>$\ }\hlstd{sudo\ python\ setup.py\ }\hlkwc{install}\hlstd{}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}

\item En la versión de scapy que bajamos nosotros hay un bug que impide cargar correctamente un archivo pcap. Nosotros hicimos un bugfix de eso, y se encuentra en la carpeta bugfix del CD. Para utilizarlo hay que reemplazar el archivo \verb_/var/lib/python-support/python2.6/sccapy/utils.py_ por el que brindamos nosotros.

\end{enumerate}

\section{Uso del sniffer}
Antes de empezar a sniffear hay que crear la base de datos para que el sniffer pueda guardar los paquetes. Para eso basta con ejecutar:

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}
\hlstd{}\hlsym{$>$\ }\hlstd{python\ persistencia.py}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}

Una vez hecho esto, ya se puede correr el sniffer con:

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}
\hlstd{}\hlsym{$>$\ }\hlstd{sudo\ python\ sniff.py}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}

Las opciones que soporta el sniffer son:
\begin{itemize}
\item -p nroPuerto (--port nroPuerto): Setea el puerto del proxy al valor nroPuerto. Por defecto es 8080
\item -i IP (--ip IP): Setea la ip del proxy al valor IP. Por defecto se ignora la ip, y se asume que todo trafico al puerto del proxy, va para el proxy.
\item -d file (--dump file): Guardar la sesión de sniffeo en un archivo pcap de nombre file.
\item -v (--verbose): Modo verbose, se muestra un resumen de cada paquete (a nivel tcp) que captura el sniffer.
\item -f file (--from-file file): Realizar la sesión simulando que se sniffean los paquetes que estan en el archivo pcap file
\item -h (--help): Mostrar ayuda, con las posibles opciones que tiene el sniffer
\end{itemize}

Una vez lanzado el sniffer continua corriendo, hasta que se lo interrumpa con \textit{ctrl+c}

\section{Instalación de reporTool}
Para instalar reporTool hay que instalar traits, para eso hacemos:

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}\\
\hlstd{}\hlslc{\#traits}\hspace*{\fill}\\
\hlstd{}\hlsym{$>$\ }\hlstd{sudo\ apt}\hlsym{{-}}\hlstd{get\ }\hlkwc{install\ }\hlstd{python}\hlsym{{-}}\hlstd{numpy}\hspace*{\fill}\\
\hlsym{$>$\ }\hlstd{sudo\ apt}\hlsym{{-}}\hlstd{get\ }\hlkwc{install\ }\hlstd{python}\hlsym{{-}}\hlstd{traitsbackendwx}\hspace*{\fill}\\
\hlsym{$>$\ }\hlstd{sudo\ apt}\hlsym{{-}}\hlstd{get\ }\hlkwc{install\ }\hlstd{python}\hlsym{{-}}\hlstd{traits}\hspace*{\fill}\\
\hlsym{$>$\ }\hlstd{sudo\ apt}\hlsym{{-}}\hlstd{get\ }\hlkwc{install\ }\hlstd{python}\hlsym{{-}}\hlstd{traitsgui}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}

\section{Uso de reporTool}
ReporTool se puede ejecutar dándole permisos de ejecución a reporTool.py y haciendo doble click en el, o sino desde una consola corriendo:

\framebox{\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\noindent
\ttfamily
\shorthandoff{"}
\hlstd{}\hlsym{$>$\ }\hlstd{python\ reporTool.py}\hspace*{\fill}\\
\mbox{}
\normalfont
\shorthandon{"}
\end{minipage}}

Una vez abierta la interfaz gráfica, la misma presenta:
\begin{itemize}
\item Desde: Fecha a partir de la cual se tienen en cuenta los mensajes HTTP para hacer los reportes
\item Hasta: Fecha hasta la cual se tienen en cuenta los mensajes HTTP para hacer los reportes
\item Formato de salida: Puede ser PDF, HTML, o ambos.
\item Salida: Nombre del archivo PDF a generar (si se escogió PDF o ambos)
\item Directorio salida de html: Nombre del directorio donde crear el reporte HTML (si se escogió HTML o ambos)
\item Lista con los reportes disponibles. Cada uno puede ser seleccionado y configurado.
\item Generar: Dispara la generación de los reportes seleccionados
\item Modo interactivo: Abre una consola python, como se comentó anteriormente
\end{itemize}

\section{Script de instalación}
Para facilitar la instalación del tp entregamos un scrip para su instalación. Para utilizarlo alcanza con correr \textit{instalador.sh} con derechos de administrador.

\section{Contenido de la entrega}
\begin{itemize}
\item ajax.py: Reporte sobre trafico ajax
\item BL: Directorio donde se encuentran las blacklists
\item blackList.py: Reporte sobre blacklists
\item bugfix: Bugfix para poder leer pcaps con scapy
\item CairoPlot.py: Librería para hacer gráficos
\item contentType.py: Reporte por content-type
\item evolucion.py: Reporte sobre la evolución del trafico para algunos sitios
\item heuristica.py: Reporte sobre heurísticas
\item heuristicas: Directorio donde se encuentran los archivos de heurísticas (keywords)
\item horarioLaboral.py: Reporte sobre usos fuera de horario laboral
\item http.sqlite: Base de datos con algunas capturas de prueba
\item instalador.sh: Script para facilitar la instalación del trabajo
\item latex.py: Helper con funciones para generar latex
\item nonHTTP.py: Reporte sobre tafico no HTTP (SSL, TLS, SSH)
\item persistencia.py: Script para generar la base de datos y declaración de los mappers a la BD
\item plasTeX: Librería para generar HTML
\item README.txt: Archivo con esta información
\item reporte.py: Clase base para los reportes
\item reporteTrucho.py: Reporte de ejemplo de como agregar nuevos reportes
\item reporTool.py: Herramienta generadora de reportes (interfaz gráfica)
\item sniff.py: Sniffer HTTP (y otros)
\item templates.py: Archivo con el template para generar el .tex para compilar a pdf
\item tex.py: Helper para usar tex desde python
\item traficoEnGral.py: Reporte sobre trafico general
\end{itemize}